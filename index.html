<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Nuestra Historia â™¾ï¸</title>
<style>
html, body {
  margin: 0;
  padding: 0;
  overflow: hidden;
  font-family: Arial, sans-serif;
}
#menu {
  position: absolute;
  width: 100%;
  height: 100%;
  background: linear-gradient(to bottom, #ff9a9e, #fad0c4);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  color: white;
  text-shadow: 3px 3px 6px black;
  z-index: 10;
}
#menu h1 { font-size: 48px; margin-bottom: 20px; }
button {
  padding: 15px 30px; font-size: 18px; margin: 10px;
  border-radius: 10px; border: none; cursor: pointer;
  background: #ff4d6d; color: white;
}
canvas { display: none; }
</style>
</head>
<body>

<div id="menu">
  <h1>ğŸŒ Nuestra Historia â™¾ï¸</h1>
  <button onclick="playMusic()">ğŸµ Escuchar nuestra canciÃ³n</button>
  <button onclick="startGame()">ğŸ® Empezar Aventura</button>
</div>

<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

// Ajustar canvas a pantalla
function resizeCanvas(){ canvas.width=window.innerWidth; canvas.height=window.innerHeight; }
resizeCanvas();
window.addEventListener("resize", resizeCanvas);

// ImÃ¡genes
let imgJacqui = new Image(); imgJacqui.src="jacqui.png";
let imgNovio = new Image(); imgNovio.src="novio.png";
let imgJuan = new Image(); imgJuan.src="juan.png";
let imgCiro = new Image(); imgCiro.src="ciro.png";

// Jugador
let gravity=0.6, jumpForce=-15;
let player={x:200,y:canvas.height-150,velocityY:0,jumping:false};
let cameraX=0, gameStarted=false, currentMessage="", sunset=false, heartInterval=null;

// ObstÃ¡culos
let obstacles=[
  {x:700,text:"21/08/2021 ğŸ’« Nos conocimos"},
  {x:1700,text:"14/07/2022 ğŸ’– Novios"},
  {x:2700,text:"20/09/2024 ğŸ  Convivimos"},
  {x:3700,text:"14/02/2026 ğŸ’– Feliz San ValentÃ­n"},
  {x:4700,text:"La historia continua... â™¾ï¸"}
];

// Plantas
let plants=[];
for(let i=400;i<5000;i+=300){ if(!obstacles.some(ob=>Math.abs(ob.x-i)<200)) plants.push({x:i,flower:Math.random()>0.6}); }

// NPCs
let npcs=[
  {x:3100,text:"ğŸ¾ Juan nos espera",img:imgJuan},
  {x:3300,text:"ğŸ± Ciro tambiÃ©n",img:imgCiro}
];

// Controles tÃ¡ctiles: solo saltar
let touchStartY=0;
canvas.addEventListener("touchstart",(e)=>{ touchStartY=e.touches[0].clientY; });
canvas.addEventListener("touchmove",(e)=>{
  const y=e.touches[0].clientY;
  const dy=touchStartY-y;
  if(dy>50 && !player.jumping){ player.velocityY=jumpForce; player.jumping=true; touchStartY=y; }
});

// Funciones
function playMusic(){ window.open("https://youtu.be/vlneT-a-KkQ","_blank"); }
function startGame(){ document.getElementById("menu").style.display="none"; canvas.style.display="block"; gameStarted=true; requestAnimationFrame(update); }
function startHeartRain(){ if(heartInterval) return; heartInterval=setInterval(()=>{ let heart=document.createElement("div"); heart.innerHTML="ğŸ’–"; heart.style.position="fixed"; heart.style.left=Math.random()*window.innerWidth+"px"; heart.style.top="-20px"; heart.style.fontSize=(20+Math.random()*20)+"px"; heart.style.pointerEvents="none"; heart.style.animation="fall 5s linear"; document.body.appendChild(heart); setTimeout(()=>heart.remove(),5000); },200); }

// Update
function update(){
  if(!gameStarted) return;
  ctx.clearRect(0,0,canvas.width,canvas.height);
  let speed=6; // velocidad automÃ¡tica
  player.x+=speed; // AVANCE AUTOMÃTICO

  cameraX=player.x-canvas.width/3;
  if(cameraX<0) cameraX=0;

  // CIELO
  if(!sunset){ ctx.fillStyle="#5c94fc"; ctx.fillRect(0,0,canvas.width,canvas.height); }
  else{ let g=ctx.createLinearGradient(0,0,0,canvas.height); g.addColorStop(0,"#ff9966"); g.addColorStop(0.5,"#ff5e62"); g.addColorStop(1,"#6a0572"); ctx.fillStyle=g; ctx.fillRect(0,0,canvas.width,canvas.height); ctx.beginPath(); ctx.arc(canvas.width-200,canvas.height-120,60,0,Math.PI*2); ctx.fillStyle="#ffcc66"; ctx.fill(); }

  // NUBES
  function drawCloud(x,y){ ctx.beginPath(); ctx.arc(x,y,25,0,Math.PI*2); ctx.arc(x+25,y-10,30,0,Math.PI*2); ctx.arc(x+55,y,25,0,Math.PI*2); ctx.arc(x+30,y+10,25,0,Math.PI*2); ctx.fill(); }
  ctx.fillStyle="white"; for(let i=0;i<8;i++){ drawCloud((i*400)-(cameraX*0.3),150); }

  // PISO
  ctx.fillStyle="#c68642"; for(let i=0;i<canvas.width/40+5;i++) ctx.fillRect((i*40)-(cameraX%40),canvas.height-100,40,40);
  ctx.fillStyle="#3cb043"; ctx.fillRect(0,canvas.height-100,canvas.width,20);

  // Plantas
  plants.forEach(p=>{ let x=p.x-cameraX, y=canvas.height-120; ctx.fillStyle="#2e8b57"; ctx.fillRect(x+8,y-20,4,20); ctx.fillStyle="#3cb043"; ctx.fillRect(x,y-20,8,8); ctx.fillRect(x+12,y-20,8,8); ctx.fillRect(x-4,y-10,8,8); ctx.fillRect(x+16,y-10,8,8); if(p.flower){ ctx.fillStyle="#ff69b4"; ctx.fillRect(x+6,y-28,8,8); } });

  // Gravedad
  player.velocityY+=gravity; player.y+=player.velocityY;
  if(player.y>=canvas.height-150){ player.y=canvas.height-150; player.jumping=false; }

  let sx=player.x-cameraX;
  if(imgJacqui.complete) ctx.drawImage(imgJacqui,sx-60,player.y-40,80,120);
  if(imgNovio.complete) ctx.drawImage(imgNovio,sx+20,player.y-40,80,120);

  // ObstÃ¡culos
  obstacles.forEach(ob=>{
    let ox=ob.x-cameraX, bw=60, bh=60, by=canvas.height-160;
    let pr=player.x+40, pl=player.x-40, ol=ob.x, or=ob.x+bw, pb=player.y+80, bt=canvas.height-160;
    if(pr>ol && pl<or && pb>bt){ player.x=ol-40; }
    ctx.fillStyle="#b55239"; ctx.fillRect(ox,by,bw,bh);
    ctx.strokeStyle="#7a2f1d"; ctx.lineWidth=2;
    ctx.beginPath(); ctx.moveTo(ox,by+bh/2); ctx.lineTo(ox+bw,by+bh/2); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(ox+bw/2,by); ctx.lineTo(ox+bw/2,by+bh/2); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(ox+bw/4,by+bh/2); ctx.lineTo(ox+bw/4,by+bh); ctx.stroke();
    if(Math.abs(player.x-ob.x)<400 && player.y<canvas.height-200){ currentMessage=ob.text; if(ob.text.includes("14/02/2026")){ sunset=true; startHeartRain(); } }
  });

  // NPCs
  npcs.forEach(n=>{ let nx=n.x-cameraX; if(n.img.complete) ctx.drawImage(n.img,nx,canvas.height-170,90,100); if(Math.abs(player.x-n.x)<120) currentMessage=n.text; });

  // Texto
  if(currentMessage!==""){ ctx.fillStyle="rgba(0,0,0,0.6)"; ctx.fillRect(0,0,canvas.width,120); ctx.fillStyle="white"; ctx.font="bold 42px Arial"; ctx.textAlign="center"; ctx.fillText(currentMessage,canvas.width/2,75); }

  requestAnimationFrame(update);
}

// Corazones
const style=document.createElement("style");
style.innerHTML=`@keyframes fall{to{transform:translateY(100vh);opacity:0;}}`;
document.head.appendChild(style);

</script>
</body>
</html>

